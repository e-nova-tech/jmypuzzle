!function(t){function n(i,n){return parseInt(t.css(i[0],n))||0}function s(t){return t[0].offsetWidth+n(t,"marginLeft")+n(t,"marginRight")}t.fn.jMyPuzzle=function(n){return n=t.extend({answer:"7,2,1,3,8,5,6,4",maxTrials:3,classOnValid:"valid",classOnNotValid:"notValid",classOnMiValid:"miValid",fnOnCheck:null,ajaxResultUrl:"",fnOnAjax:null,fnOnReset:null,elts:new Array},n||{}),this.each(function(){function e(s,a){if(s>=a.length){var l=a.length,r=(1*g+.5*N)/l*100,o=O,f="";for(i=0;l>i;i++)f+=m[i].initialN+1+",";return f=f.replace(/,+$/,""),jSonResults={nb_words:l,nb_valid:g,nb_not_valid:V,nb_mi_valid:N,success_rate:r,trial_nb:o,max_trials:n.maxTrials,answer:f},null!==n.fnOnCheck?n.fnOnCheck(jSonResults):void(""!==n.ajaxResultUrl&&t.post(n.ajaxResultUrl,jSonResults,function(t){null!==n.fnOnAjax&&n.fnOnAjax(t)}))}m[s].removeClass(n.classOnValid+" "+n.classOnMiValid+" "+n.classOnNotValid);var c=parseInt(m[s].pos.top);return m[s].animate({top:c+7+"px"},{duration:75,complete:function(){if(m[s].initialN+1==a[s])m[s].addClass(n.classOnValid),g++;else if(m[s+2]&&n.answer.indexOf(m[s].initialN+1+","+(m[s+1].initialN+1)+","+(m[s+2].initialN+1))>=0){var t=0;for(t=0;t<a.length&&m[s].initialN+1!=a[t];t++);for(var i=0;i<a.length;i++){if(!m[s+i]||a[i+t]!=m[s+i].initialN+1)return void(s+=i-1);i>0?m[s+i].animate({top:c+7+"px"},75).addClass(n.classOnMiValid).animate({top:c+"px"},100):m[s+i].addClass(n.classOnMiValid),N++}}else m[s].addClass(n.classOnNotValid),V++}}).animate({top:c+"px"},{duration:100,complete:function(){return e(s+1,a)}})}function a(t,i,n,s){var e=null!==this.eltPos?this.eltPos:l(n);if(this.eltPos=l(n),this.eltPos.left!=e.left)if(u=this.eltPos.left>e.left?d:h,u==d){if(n.n<s.length-1){var a=s[n.n+1],r=a.pos.left+parseInt(a.outerWidth/2);this.eltPos.left+n.outerWidth>r&&(n.insertAfter(a),a.pos.left=n.pos.left,n.pos.left+=a.outerWidth,s[n.n]=a,s[n.n+1]=n,s[n.n].n=n.n,n.n=n.n+1,a.animate({left:a.pos.left+"px"},300))}}else if(u==h&&n.n>0){var o=s[n.n-1],f=o.pos.left+parseInt(o.outerWidth/2);this.eltPos.left<f&&(n.insertBefore(o),n.pos.left=o.pos.left,o.pos.left+=n.outerWidth,s[n.n]=o,s[n.n-1]=n,s[n.n].n=n.n,n.n=n.n-1,o.animate({left:o.pos.left+"px"},300))}}function l(t){return{left:parseInt(t.css("left")),top:"auto"==t.css("top")?0:parseInt(t.css("top"))}}function r(){p=0,c.each(function(){t(this).css("left",p+"px"),p+=s(t(this)),t(this).removeClass(n.classOnValid+" "+n.classOnMiValid+" "+n.classOnNotValid),t(this).addClass("normal")})}var o=t(this),f=t("ul",o),c=t("li",f),p=0,u=null,d=1,h=2;this.elts=new Array(c.size());var m=this.elts,x=0,v=0,O=0,g=0,V=0,N=0;f.css({display:"block",position:"absolute"}),c.css({"float":"left","list-style-type":"none",display:"block",position:"absolute"}),n.maxTrials>0&&t("#trials").length&&t("#trials").html("0/"+n.maxTrials),c.each(function(){v+=s(t(this))}),f.css({width:v,height:c.height()+parseInt(c.css("marginTop"))+parseInt(c.css("marginBottom"))+2*parseInt(c.css("paddingBottom"))+2*parseInt(c.css("paddingTop"))+"px"}),f.css("left",o.offset().left+(o.width()-v)/2),r(),c.each(function(){var i=t(this);i.outerWidth=s(t(this)),i.pos=l(i),i.initialN=x,i.n=x,i.draggable({containment:o,drag:function(t,n){a(t,n,i,m)},start:function(){var t=m[i.n];t.css({opacity:.4,"z-index":200})},stop:function(){var t=m[i.n];t.css({opacity:1,"z-index":5}),t.animate({left:t.pos.left,top:t.pos.top},300)}}),m[x++]=i}),t("#check").length&&t("#check").click(function(){if(g=0,V=0,N=0,n.maxTrials>0){if(O>=n.maxTrials)return;O++,t("#trials").html(O+"/"+n.maxTrials)}var i=n.answer.split(",");return i.length!=c.size()&&alert("error - answer doesn't match !"),e(0,i)}),t("#reset").length&&t("#reset").click(function(){var t=c.size();for(i=0;t>i;i++)if(m[i].initialN!=i)for(j=i;t>j;j++)if(m[j].initialN==i){var s=m[i];m[i]=m[j],m[i].n=i,m[i].insertBefore(m[i+1]),m[j]=s,m[j].n=j,t>j+1?m[j].insertBefore(m[j+1]):m[j].insertAfter(m[j-1]);break}for(r(),i=0;t>i;i++)m[i].pos=l(m[i]);n.fnOnReset()})})}}(jQuery);